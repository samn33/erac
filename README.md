erac
====

元号と西暦の相互変換に関する諸々の面倒を解決するEmacs-Lispプログラムです(eracは"Era Calculator"の略です)。


## 機能

以下5つの機能があります。

### 1. 和暦年-西暦年変換

和暦年を西暦年に変換することができます。

### 2. 西暦年-和暦年変換

西暦年を和暦年に変換することができます。

### 3. 元号情報表示

ある元号(例えば昭和)が西暦何年から何年まで何年間続いたかを表示できます。

### 4. 年差計算

ある和暦年(または西暦年)と別のある和暦年(または西暦年)との差が何年間あるかが計算できます。この計算のことを「年差計算」と呼びます(eracでの定義)。

### 5. 年前後計算

ある和暦年(または西暦年)から何年後または何年前が和暦もしくは西暦で何年になるかが計算できます。この計算のことを「年前後計算」と呼びます(eracでの定義)。


## インストール

(1) erac.elをload-pathの通ったディレクトリに入れてください。

(2) 以下の行をinit.elに入れてください。

    (autoload 'erac "erac")
    (define-key global-map "\C-xw" 'erac)

eeracを起動するキーは上の例では'C-x w'になっていますが、お好みみに応じて別のキーに割り当ててもOKです。


## 使用法

C-x wでeracを起動すると、ミニバッファに'erac>'というプロンプトが表示されます。利用したい機能に応じ、下記の仕様に従った式を入力します。

### 1. 和暦年-西暦年変換

入力文字列の先頭が数字以外の文字列であり、かつその後に数字列が続いている場合、その文字列が和暦年を表すものとみなされ、和暦年-西暦年変換が実行されます。例えば、昭和39年が西暦で何年かを知りたい場合、

    erac> 昭和39

と入力すると、

    昭和39年は、1964年です。

という具合に結果が表示されます。

### 2. 西暦年-和暦年変換

入力文字列が数字しか含んでいない場合、西暦年を表しているとみなされ、西暦年-和暦年変換が実行されます。例えば、西暦645年が和暦で何年かを知りたい場合、

    erac> 645

と入力すると、

    645年は、大化1年です。

という具合に結果が表示されます。

### 3. 元号情報表示

入力文字列が数字以外の文字列しか含んでいない場合、それが元号を表しているものとみなされ、元号情報を表示するための処理が実行されます。例えば、明治が何年から何年まで続いたかを知りたい場合、

    erac> 明治

と入力すると、

    明治は、1868年から1911年までの44年間続きました。

という具合に結果が表示されます。

### 4. 年差計算

オペレータ'~'が年差演算を表します。入力文字列に'~'が含まれるとき、年差計算が実行されます。例えば、2000年と大正10年との年差を計算したい場合、以下のような形式で入力します。

    erac> 2000~大正10

結果は、

    2000年と大正10年との年差は、79年です。

という具合に表示されます。オペレータ'~'をはさんで前の項もしくは後ろの項が省略された場合、変数erac-default-yearにセットされている値がそこに代入され計算されます。例えば、

    erac> ~昭和20

とすると、現在と昭和20年の年差が計算され、2021年と昭和20年との年差は、76年です。と表示されます(現在が2021年の場合の例)。

変数erac-default-yearは上の例で示した標準的な設定では、何もセットされていません。その場合、erac起動時に内部で現在の西暦年に置換されます。すなわち、現在が2021年であれば、erac-default-year は"2021"という値になります。現在年とは違う値にしたい場合、例えば、init.elの中で、

    (setq erac-default-year "1900")

のように値を明示的にセットしてください。

### 5. 年前後計算

オペレータ'+'または'-'が年前後演算を表します('+'が年後演算、'-'が年前演算)。入力文字列に'+'または'-'が含まれるとき、年前後演算が実行されます。例えば、明治1年の100年後が何年か知りたい場合、以下のような形式で入力します。
		
    erac> 明治1+100

結果は、明治1年の100年後は1968(昭和43)年です。という具合に表示されます。オペレータ'+'または'-'の前の項が省略された場合、変数erac-default-yearにセットされている値がそこに代入され計算されます。例えば、

    erac> -40

とすると、現在(変数erac-default-yearに何か値がセットされていればその西暦年)の40年前が何年になるかが計算され、2021年の40年前は1981(昭和56)年です。と表示されます。オペレータ'+'または'-'の後の項が省略された場合、値0がそこに代入され計算されます。


## その他

### 元号データの更新

erac.elの中身を見ればわかりますが、元号のデータは令和が9999年まで続くことを想定し記述されています。元号が変わったら適当に変更してください。

    (defun erac-initialize ()
    	(if (equal erac-default-year nil)
    	  (setq erac-default-year (substring (current-time-string) -4))
    	  )
    	(setq erac-alist
    		  '(("大化" "645" "649")
    			("白雉" "650" "654")
    			   ....
    
    			("大正" "1912" "1925")
    			("昭和" "1926" "1988")
	            ("平成" "1989" "2018")
		        ("令和" "2019" "9999"))))

### 元号の境界についての注意事項

特定の元号の最後の年は、次の元号の元年(1年)でもあります。例えば、平成時代は平成31年(2019年)の4月30日までで、翌日以降、令和1年になりました。eracでは、面倒なので(作る側の論理ですみません)、元号の最後の年は、次の元号の元年(1年)であるとしています。つまり、2019年は平成31年ではなく、令和1年としています。従って、平成は31年ではなく30年間続いたことになります。すべての元号についてこのような解釈で計算・表示しています。

### 既知のバグ

和暦年-西暦年変換で、ありえない和暦年を指定してもエラーになりません。例えば、「昭和90」と入力すると、「昭和90年は、2015年です。」としれっと表示してくれちゃいます(ご愛嬌です)。


## 環境

- Emacs


## ライセンス

Apache License 2.0


## 作者

[Sam.N](http://github.com/samn33)
